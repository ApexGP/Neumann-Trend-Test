# 变更日志 (Changelog)

本文档记录了诺依曼趋势测试工具的所有重大变更，按版本和时间顺序组织。

## [2.2.0] - 2025-05-26

### 🌐 统一启动方式

#### Web 服务器集成

- ✅ **新增** CLI 应用中集成 Web 服务器启动功能
- ✅ **新增** 在主菜单中添加"启动 Web 服务器"选项
- ✅ **新增** Web 服务器配置界面，支持端口和 Web 资源目录设置
- ✅ **新增** Web 服务器状态管理，支持启动、停止和状态查询
- ✅ **新增** 智能端口配置，支持自定义端口并保存到配置文件

#### 启动脚本简化

- ✅ **新增** 统一启动脚本 `start.bat` (Windows) 和 `start.sh` (Linux/macOS)
- ✅ **移除** 独立的 Web 启动脚本，简化项目结构
- ✅ **改进** 启动脚本提供中英文双语说明
- ✅ **优化** 错误处理和用户提示信息

#### 用户体验改进

- ✅ **新增** Web 服务器后台运行模式，用户可继续使用 CLI 功能
- ✅ **新增** Web 服务器访问 URL 显示，方便用户打开浏览器
- ✅ **新增** Web 服务器使用说明和操作指导
- ✅ **新增** 智能冲突检测，避免重复启动服务器

### 🎯 自定义置信度交互优化

#### 选项式交互界面

- ✅ **改进** 自定义置信度设置改为选项式交互，提升用户体验
- ✅ **新增** 选项 1：手动输入自定义置信度值和标准值文件
- ✅ **新增** 选项 2：从示例文件目录加载预设置信度配置
- ✅ **新增** 示例文件自动扫描和列表显示功能

#### 示例文件管理

- ✅ **新增** 自动扫描 `data/sample/ConfidenceLevel/` 目录中的示例文件
- ✅ **新增** 支持 JSON 和 CSV 格式的示例文件选择
- ✅ **新增** 示例文件置信度自动检测和显示
- ✅ **新增** 示例文件加载的智能错误处理

### 🔧 技术架构改进

#### Web 服务器集成架构

- ✅ **新增** TerminalUI 类中的 Web 服务器成员变量和管理方法
- ✅ **新增** `startWebServer()` 方法实现完整的 Web 服务器生命周期管理
- ✅ **新增** Web 服务器配置持久化，端口设置自动保存
- ✅ **新增** 析构函数确保 Web 服务器正确停止

#### 翻译系统扩展

- ✅ **新增** Web 服务器相关的完整中英文翻译键
- ✅ **新增** 自定义置信度交互相关的翻译键
- ✅ **新增** 错误处理和用户提示的翻译支持

### 📚 文档更新

#### 用户文档

- ✅ **更新** README.md，反映新的统一启动方式
- ✅ **更新** 版本号从 v2.1.0 升级到 v2.2.0
- ✅ **更新** 发布包结构说明，移除独立 Web 应用
- ✅ **更新** 使用指南，详细说明 Web 服务器集成功能

#### 项目结构

- ✅ **简化** 启动脚本，只保留统一的 start.bat 和 start.sh
- ✅ **优化** 项目根目录结构，减少文件数量
- ✅ **改进** 发布包组织，更加简洁明了

### 🐛 问题修复

#### 交互体验修复

- 🐛 **修复** 自定义置信度设置的用户体验问题
- 🐛 **修复** 示例文件路径处理的兼容性问题
- 🐛 **修复** Web 服务器重复启动的检测逻辑

### ⚠️ 重要变更

1. **启动方式变更**：现在只需要运行一个启动脚本，Web 功能集成在 CLI 中
2. **Web 服务器管理**：Web 服务器现在作为 CLI 的一个功能模块，而非独立应用
3. **自定义置信度交互**：改为更友好的选项式交互方式
4. **项目结构简化**：移除了独立的 Web 启动脚本

### �� 向后兼容性

- ✅ **保持** 所有现有配置文件格式兼容
- ✅ **保持** 数据文件和标准值文件格式兼容
- ✅ **保持** CLI 功能完全兼容
- ✅ **保持** Web 界面功能完全兼容

---

## [2.1.0] - 2025-05-28

### 🎨 用户界面增强

#### 置信度配置系统优化

- ✅ **新增** 可视化置信度设置菜单，支持预设值选择（90%, 95%, 99%）
- ✅ **新增** 自定义置信度输入功能，支持 0.0-1.0 范围内任意值
- ✅ **新增** 置信度配置持久化保存，重启后保持用户设置
- ✅ **改进** 置信度选择界面，动态显示支持的置信度水平
- ✅ **新增** 默认值标识，清晰显示推荐的 95%置信度

#### 状态栏显示系统

- ✅ **新增** 右上角状态栏，实时显示当前置信度水平
- ✅ **新增** 应用标题和状态信息的美观布局
- ✅ **新增** 彩色状态栏，使用青色和绿色突出显示重要信息
- ✅ **改进** 终端宽度自适应，确保状态栏在不同终端下正确显示

#### 测试流程优化

- ✅ **改进** 新建测试流程，自动使用配置的置信度而非每次询问
- ✅ **新增** 置信度使用提示，告知用户当前使用的置信度水平
- ✅ **新增** 设置修改引导，提示用户可在设置菜单中更改置信度
- ✅ **优化** 测试结果显示，更清晰地展示使用的置信度参数

#### 结果显示美化

- ✅ **改进** 测试结果汇总框的边框设计，使用完整的闭合边框
- ✅ **优化** 边框宽度计算，确保内容正确对齐
- ✅ **新增** 彩色边框支持，根据测试结果使用不同颜色
- ✅ **改进** 内容填充计算，解决边框对齐问题

### 🔧 配置系统改进

#### 配置文件路径管理

- ✅ **新增** `setConfigFilePath()` 方法，支持动态设置配置文件路径；导出的`svg`文件默认保存在**data/svg**目录下
- ✅ **修复** 配置保存路径不一致问题，确保加载和保存使用相同路径
- ✅ **改进** 启动逻辑，正确设置配置文件路径后再进行保存操作
- ✅ **新增** 配置目录自动创建，确保配置文件能够正确保存

#### 语言设置持久化

- ✅ **修复** 语言设置无法持久保存的问题
- ✅ **改进** 语言切换流程，立即保存设置并提供用户反馈
- ✅ **新增** 配置保存状态提示，告知用户设置是否成功保存
- ✅ **优化** 语言菜单返回逻辑，设置完成后自动返回主菜单

### 🏗️ 架构优化

#### 应用启动流程改进

- ✅ **改进** CLI 应用启动逻辑，正确处理 release 文件结构
- ✅ **修复** 配置文件加载顺序，确保路径设置在配置保存之前完成
- ✅ **新增** 配置目录检查和创建逻辑
- ✅ **优化** 错误处理，提供更友好的启动失败提示

#### 代码质量提升

- ✅ **改进** 边框计算逻辑，使用更精确的宽度计算方法
- ✅ **优化** 颜色输出代码，统一使用 TerminalUtils 进行彩色输出
- ✅ **重构** 状态栏显示代码，提高代码可维护性
- ✅ **完善** 注释和文档，提高代码可读性

### 🐛 问题修复

#### 显示问题修复

- 🐛 **修复** 测试结果汇总框边框对齐问题
- 🐛 **修复** 状态栏在不同终端宽度下的显示问题
- 🐛 **修复** 彩色输出在某些终端下的兼容性问题
- 🐛 **修复** 边框宽度计算错误导致的显示异常

#### 配置问题修复

- 🐛 **修复** 置信度设置无法保存的问题
- 🐛 **修复** 语言设置重启后丢失的问题
- 🐛 **修复** 配置文件路径不一致导致的保存失败
- 🐛 **修复** 配置目录不存在时的创建失败问题

### 📚 文档更新

#### 用户文档

- ✅ **更新** README.md，添加 v2.1.0 新功能说明
- ✅ **新增** 置信度配置使用指南
- ✅ **新增** 状态栏功能说明
- ✅ **更新** 版本号和发布包信息

#### 开发文档

- ✅ **完善** 代码注释，特别是新增功能的注释
- ✅ **更新** 变更日志，详细记录所有改进和修复
- ✅ **新增** 配置系统架构说明

### ⚠️ 重要变更

1. **配置文件路径**：现在正确支持 release 文件结构下的配置保存
2. **置信度设置**：新的可视化设置界面，支持更灵活的配置
3. **状态栏显示**：新增的状态栏提供实时的应用状态信息
4. **测试流程**：简化的测试流程，减少用户重复输入

### 🔄 向后兼容性

- ✅ **保持** 所有现有配置文件格式兼容
- ✅ **保持** 命令行参数和 API 兼容性
- ✅ **支持** 旧版本配置文件自动升级
- ✅ **保持** 数据文件格式完全兼容

### 其他

- **移除** `.vscode/`文件索引

---

## [2.0.0] - 2025-05-24

### 🚀 重大更新 - 完整三阶段改进

这是一个重大版本更新，包含了完整的三阶段系统改进，显著提升了用户体验、功能性和可靠性。

### 🌐 第一阶段：基础设施建设

#### 双语国际化支持系统

- ✅ **新增** 完整的中文/英文双语界面支持
- ✅ **新增** 运行时语言切换功能
- ✅ **新增** 外部翻译文件支持 (`config/translations.json`)
- ✅ **新增** 内置默认翻译作为后备
- ✅ **新增** 便利宏 `_()` 和 `_f()` 简化多语言开发
- ✅ **实现文件**: `include/core/i18n.h`, `src/core/i18n.cpp`

#### 统一配置管理系统

- ✅ **新增** JSON 格式配置文件 (`config/config.json`)
- ✅ **新增** 自动创建默认配置
- ✅ **新增** 运行时配置修改和持久化保存
- ✅ **新增** 单例模式确保全局配置一致性
- ✅ **支持配置项**: 语言设置、路径配置、置信度、UI 选项、数据处理限制
- ✅ **实现文件**: `include/core/config.h`, `src/core/config.cpp`

#### 增强错误处理系统

- ✅ **新增** 分类错误代码系统（文件、数据、计算、网络、配置、系统）
- ✅ **新增** 多语言错误消息和用户友好的解决建议
- ✅ **新增** 自定义异常类 `NeumannException`
- ✅ **新增** 统一错误日志记录和显示
- ✅ **实现文件**: `include/core/error_handler.h`, `src/core/error_handler.cpp`

### 🎨 第二阶段：用户体验提升

#### 彩色终端输出系统

- ✅ **新增** 完整的 ANSI 颜色支持（16 色 + 亮色变体）
- ✅ **新增** 文本样式支持（加粗、斜体、下划线等）
- ✅ **新增** 自动平台检测和兼容性处理
- ✅ **新增** Windows 10+ ANSI 转义序列支持
- ✅ **新增** 便利的消息类型函数（成功、警告、错误、信息）
- ✅ **实现文件**: `include/cli/terminal_utils.h`, `src/cli/terminal_utils.cpp`

#### 进度指示器和加载动画

- ✅ **新增** 可配置的进度条显示
- ✅ **新增** 旋转加载指示器（Spinner）
- ✅ **新增** 实时进度更新和光标控制
- ✅ **新增** 清屏和终端操作功能

#### 增强的表格格式化

- ✅ **新增** 自动列宽调整和多种对齐方式
- ✅ **新增** 彩色表格分隔线
- ✅ **新增** 内容截断和省略处理
- ✅ **新增** 中文字符宽度正确计算

#### Excel 文件支持基础架构

- ✅ **新增** 文件类型自动检测（.csv, .xlsx, .xls）
- ✅ **新增** 增强的 CSV 解析（支持引号字段）
- ✅ **新增** 自动列类型检测（数值/文本）
- ✅ **新增** 智能时间列和数据列识别
- ✅ **新增** 数据预览和验证功能
- ✅ **实现文件**: `include/core/excel_reader.h`, `src/core/excel_reader.cpp`

#### CLI 界面全面美化

- ✅ **改进** 集成彩色输出到所有界面元素
- ✅ **改进** 美化的欢迎界面和菜单系统
- ✅ **改进** 彩色的测试结果表格（趋势结果颜色编码）
- ✅ **改进** 进度指示器集成
- ✅ **改进** 统一的消息样式和错误显示

### 🔧 第三阶段：标准值修正和验证

#### 标准值表数据修正

- 🐛 **修复** 标准值表中 P(95%)和 P(99%)数据不匹配问题
- 🐛 **修复** JSON 文件中数据排序问题，确保按样本数升序排列
- ✅ **更新** 置信度选择界面，动态显示支持的置信度
- ✅ **验证** 大数据集处理能力（4-60 个数据点）
- ✅ **新增** 大数据集测试文件：
  - `large_dataset_45_points.csv` (45 个数据点)
  - `extra_large_dataset_55_points.csv` (55 个数据点)

#### 批量处理系统

- ✅ **新增** 目录扫描和批量文件处理
- ✅ **新增** 实时进度显示和错误处理
- ✅ **新增** 批量结果汇总和统计分析
- ✅ **新增** CSV 和 HTML 格式的批量报告导出
- ✅ **实现文件**: `include/core/batch_processor.h`, `src/core/batch_processor.cpp`

#### 数据可视化系统

- ✅ **新增** ASCII 艺术图表（CLI 内实时显示）
- ✅ **新增** SVG 格式高质量矢量图表导出
- ✅ **新增** 趋势图、PG 值分布图、阈值比较图
- ✅ **实现文件**: `include/core/data_visualization.h`, `src/core/data_visualization.cpp`

#### 高级统计功能

- ✅ **新增** 多数据集统计分析
- ✅ **新增** 趋势检测统计汇总
- ✅ **新增** PG 值分布分析
- ✅ **新增** 数据集比较功能

### 🛠️ 技术架构改进

#### 模块化设计

- ✅ **重构** 核心算法、CLI 界面、Web 服务完全分离
- ✅ **实现** 单例模式确保全局状态一致性
- ✅ **应用** RAII 模式实现自动资源管理

#### 性能优化

- ✅ **优化** 静态链接，无运行时依赖
- ✅ **优化** O(n²)时间复杂度的 PG 值计算算法
- ✅ **优化** 数据流式处理，支持大型数据集

#### 跨平台兼容性

- ✅ **Windows**: 原生 ANSI 颜色支持，UTF-8 编码
- ✅ **Linux/macOS**: 完整 POSIX 兼容，终端颜色自适应
- ✅ **Web 标准**: HTML5 + JavaScript，现代浏览器支持

### 📁 文件发布系统改进

#### 发布包生成

- ✅ **改进** `create-release.bat` 脚本，支持特殊字符文件名
- ✅ **新增** 自动复制标准值参考文件（MD 和 PDF 格式）
- ✅ **改进** 用户说明文档生成
- ✅ **新增** 完整的目录结构说明

#### 启动脚本更新

- ✅ **更新** `start-cli-app.bat` 和 `start-web-app.bat`
- ✅ **新增** 参数传递支持
- ✅ **改进** 错误处理和用户提示

### 📊 数据处理能力扩展

#### 扩展的数据点支持

- ✅ **扩展** 样本数量支持从 4-20 扩展到 4-60
- ✅ **验证** 大数据集处理稳定性
- ✅ **新增** 置信度支持：95%, 99%, 99.9%（移除 0.90 和 0.975）

#### 数据格式支持

- ✅ **完善** CSV 文件解析，支持复杂格式
- ✅ **准备** Excel 文件支持框架
- ✅ **新增** 数据验证和清理功能

### 🌐 多语言支持完善

#### 翻译内容扩展

- ✅ **新增** 558 项完整的中英文翻译条目
- ✅ **覆盖** 所有 UI 元素、错误消息、帮助信息
- ✅ **新增** Excel 文件、批量处理、数据可视化相关翻译
- ✅ **新增** 教程系统和统计分析翻译

#### 国际化框架

- ✅ **支持** 运行时语言切换
- ✅ **支持** 外部翻译文件加载
- ✅ **支持** 格式化字符串翻译

### ⚙️ 配置系统完善

#### 配置项扩展

```json
{
  "language": "zh", // 界面语言
  "defaultConfidenceLevel": 0.95, // 默认置信度
  "dataDirectory": "data", // 数据目录
  "webRootDirectory": "web", // Web资源目录
  "defaultWebPort": 8080, // Web端口
  "showWelcomeMessage": true, // 显示欢迎消息
  "enableColorOutput": true, // 彩色输出
  "maxDataPoints": 1000, // 最大数据点数
  "autoSaveResults": true // 自动保存结果
}
```

### 🧪 测试和验证

#### 示例数据扩展

- ✅ **新增** `large_dataset_45_points.csv` - 45 个数据点的药物含量趋势
- ✅ **新增** `extra_large_dataset_55_points.csv` - 55 个数据点的活性成分衰减
- ✅ **保留** 原有示例数据集
- ✅ **新增** 大数据集处理说明文档

#### 功能验证

- ✅ **验证** 标准值表数据正确性
- ✅ **验证** 大数据集处理稳定性
- ✅ **验证** 跨平台兼容性
- ✅ **验证** 彩色输出在不同终端的表现

### 📚 文档更新

#### 用户文档

- ✅ **全面更新** README.md，包含完整功能介绍
- ✅ **新增** 快速开始指南和详细使用说明
- ✅ **新增** 故障排除和性能建议章节
- ✅ **新增** 技术特性和架构说明

#### 开发文档

- ✅ **新增** 贡献指南和开发环境设置
- ✅ **更新** 构建说明和依赖要求
- ✅ **完善** API 文档和代码注释

### 🔄 向后兼容性

- ✅ **保持** 原有数据格式兼容性
- ✅ **保持** 命令行参数兼容性
- ✅ **支持** 配置文件自动迁移
- ✅ **保持** Web API 兼容性

### ⚠️ 重大变更

1. **置信度支持变更**：移除 0.90 和 0.975 置信度，标准化为 0.95, 0.99, 0.999
2. **样本数量扩展**：从 4-20 扩展到 4-60 个数据点
3. **配置文件格式**：新增多个配置项，旧配置文件会自动升级
4. **文件结构调整**：标准值文件和翻译文件位置调整

### 其他改进

1. **移除`create-release.bat`**：该发布脚本现在更名为`install.bat`，存放在[NTT-x86_64-windows-v2.0.0-build.zip](https://github.com/Xyf0606/Neumann-Trend-Test/releases)中，供 Windows 用户自行构建`release`
2. **添加`.clang-format`**：统一代码风格
3. **修改`config/`文件可见性**：移除普通用户在程序中修改默认配置的权限，用户配置单独储存

---

## [1.2.0] - 2025-05-21

### 构建系统升级

- 集成 CMakePresets.json，提供标准化构建配置
  - 添加 6 个预设配置：msvc-release、msvc-debug、mingw-release、mingw-debug、linux-release、linux-debug
  - 支持不同编译器和平台的无缝切换
  - 自动配置 vcpkg 和编译器路径
- 优化依赖项检测逻辑，避免自动下载阻塞构建流程
- 为 MSVC 和 MinGW 工具链提供专用构建预设
- 移除冗余的构建脚本，简化构建命令
- 改进输出目录结构
  - 二进制文件现统一输出至项目根目录的 bin 文件夹
  - 库文件统一输出至项目根目录的 lib 文件夹
  - 简化程序访问路径，便于直接调用
  - 更新启动脚本，自动查找新路径下的可执行文件

### 应用程序启动改进

- 添加标准化启动脚本
  - 新增 start-cli-app.bat/sh 用于启动命令行应用
  - 更新 start-web-app.bat 适配新的输出目录
  - 自动检测不同构建环境下的可执行文件位置
  - 支持命令行参数传递
- 添加预编译版本发布功能
  - 新增 create-release.bat/sh 脚本自动创建发布包
  - 支持一键打包应用程序及所需资源
  - 生成适用于最终用户的简化说明文档

### 开发工具增强

- 大幅改进 clangd 配置，修复源码解析问题
  - 使用.clangd 配置文件替代旧的 setup-clangd.bat 脚本
  - 添加智能包含路径检测，支持不同构建目录结构
  - 配置多个库路径备选项，提高解析成功率
  - 添加编译器特定路径支持
- 优化 .clangd 配置文件，提供更准确的包含路径
- 完善 VSCode 集成配置，增强编辑体验
- 添加编译器特定的路径支持，解决跨编译器使用问题

### 项目结构优化

- 清理冗余构建脚本和辅助文件
  - 移除了 10 个冗余脚本文件，包括：build-preset、cleanup-scripts、run-web-utf8 等
  - 合并功能到标准化的 build.bat/build.sh 脚本中
  - 删除了 mingw-toolchain.cmake，通过 CMakePresets 替代
- 更新 .gitignore 规则
- 优化项目文档结构
- 简化构建和设置流程

## [1.1.0] - 2025-05-20

### 构建系统改进

- 添加平台自动检测功能，根据平台选择合适的工具链
- 改进 Windows 平台 MinGW 工具链支持
- 添加自定义 MinGW 工具链配置文件
- 为 clangd 语言服务器添加支持
- 更新构建脚本，支持不同编译器选择

### 开发体验

- 添加 VSCode 配置文件，优化开发体验
- 自动生成 compile_commands.json 文件
- 配置 clangd 语言服务器与 MinGW 集成
- 文档更新，增加高级构建配置说明

## [1.0.0] - 2025-5-11

### 项目重构

- 完全重构项目结构，采用模块化设计
- 创建了核心模块、CLI 模块和 Web 模块
- 使用 CMake 构建系统管理项目
- 添加了测试框架和单元测试

### 新功能

- 支持多种置信水平 (0.90, 0.95, 0.975, 0.99)
- 样本大小支持从 4 到 20
- 添加数据管理功能，支持保存和加载数据集
- 增强 CSV 导入功能
- 添加交互式终端界面 (使用 FTXUI 库)
- 添加 Web 界面 (使用 Crow 框架)
- JSON 文件存储所有标准 W(P)值

### 文档

- 创建详细的 README 文件
- 添加构建说明和使用说明
- 添加示例数据文件

### 开发工具

- 添加 Windows 和 Linux/Mac 构建脚本
- 配置单元测试和 CTest 集成
- 自动下载依赖库
